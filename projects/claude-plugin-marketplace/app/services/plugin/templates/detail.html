{% extends "base.html" %}

{% block title %}{{ plugin.display_name }} - Claude Plugin Marketplace{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Plugin Header -->
    <div class="bg-white shadow-md rounded-lg p-6 mb-6">
        <div class="flex justify-between items-start mb-4">
            <div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">{{ plugin.display_name }}</h1>
                <div class="flex items-center text-gray-600">
                    <span>by</span>
                    <a href="/users/@{{ author.username }}" class="ml-1 text-blue-600 hover:text-blue-800 font-medium">
                        @{{ author.username }}
                    </a>
                    {% if latest_version %}
                    <span class="mx-2">•</span>
                    <span class="text-gray-700 font-medium">v{{ latest_version.version }}</span>
                    {% endif %}
                    <span class="mx-2">•</span>
                    <span class="text-gray-500 text-sm">Updated {{ plugin.updated_at.strftime('%B %d, %Y') }}</span>
                </div>
            </div>
            <div class="flex gap-2">
                {% if download_url %}
                <a href="{{ download_url }}" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">
                    Download ZIP
                </a>
                {% endif %}
                <button onclick="showReportModal()" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded">
                    Report
                </button>
            </div>
        </div>
        
        <p class="text-gray-700 text-lg">
            {{ plugin.description }}
        </p>
    </div>

    <!-- Installation Instructions -->
    <div class="bg-white shadow-md rounded-lg p-6 mb-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Installation</h2>
        
        <div class="space-y-4">
            <div>
                <p class="text-gray-700 mb-2">1. Add this marketplace to Claude Code:</p>
                <div class="bg-gray-100 p-3 rounded flex items-center justify-between">
                    <code class="text-sm">{{ marketplace_command }}</code>
                    <button onclick="copyToClipboard('{{ marketplace_command }}')" 
                            class="bg-blue-500 hover:bg-blue-600 text-white text-sm py-1 px-3 rounded">
                        Copy
                    </button>
                </div>
            </div>
            
            <div>
                <p class="text-gray-700 mb-2">2. Install the plugin:</p>
                <div class="bg-gray-100 p-3 rounded flex items-center justify-between">
                    <code class="text-sm">{{ install_command }}</code>
                    <button onclick="copyToClipboard('{{ install_command }}')" 
                            class="bg-blue-500 hover:bg-blue-600 text-white text-sm py-1 px-3 rounded">
                        Copy
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Components -->
    {% if components %}
    <div class="bg-white shadow-md rounded-lg p-6 mb-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Components</h2>
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
            {% if components.commands %}
            <div class="text-center">
                <div class="text-3xl font-bold text-blue-600">{{ components.commands }}</div>
                <div class="text-gray-600">Commands</div>
            </div>
            {% endif %}
            {% if components.agents %}
            <div class="text-center">
                <div class="text-3xl font-bold text-green-600">{{ components.agents }}</div>
                <div class="text-gray-600">Agents</div>
            </div>
            {% endif %}
            {% if components.skills %}
            <div class="text-center">
                <div class="text-3xl font-bold text-purple-600">{{ components.skills }}</div>
                <div class="text-gray-600">Skills</div>
            </div>
            {% endif %}
            {% if components.hooks %}
            <div class="text-center">
                <div class="text-3xl font-bold text-orange-600">{{ components.hooks }}</div>
                <div class="text-gray-600">Hooks</div>
            </div>
            {% endif %}
            {% if components.mcp_servers %}
            <div class="text-center">
                <div class="text-3xl font-bold text-red-600">{{ components.mcp_servers }}</div>
                <div class="text-gray-600">MCP Servers</div>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- README -->
    {% if readme_html %}
    <div class="bg-white shadow-md rounded-lg p-6 mb-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">README</h2>
        <div class="prose max-w-none">
            {{ readme_html }}
        </div>
    </div>
    {% endif %}

    <!-- Version History -->
    {% if versions|length > 1 %}
    <div class="bg-white shadow-md rounded-lg p-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Version History</h2>
        <div class="space-y-2">
            {% for version in versions %}
            <div class="flex items-center justify-between py-2 border-b last:border-0">
                <div class="flex items-center">
                    <span class="font-mono text-gray-700">v{{ version.version }}</span>
                    {% if version.is_latest %}
                    <span class="ml-2 bg-green-100 text-green-800 text-xs px-2 py-1 rounded">Latest</span>
                    {% endif %}
                </div>
                <span class="text-gray-500 text-sm">{{ version.uploaded_at.strftime('%B %d, %Y') }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<!-- Report Modal (placeholder) -->
<div id="reportModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
        <h3 class="text-lg font-bold mb-4">Report Plugin</h3>
        <p class="text-gray-600 mb-4">Reporting functionality will be available in Phase 5.</p>
        <button onclick="hideReportModal()" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">
            Close
        </button>
    </div>
</div>

<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        alert('Copied to clipboard!');
    });
}

function showReportModal() {
    document.getElementById('reportModal').classList.remove('hidden');
}

function hideReportModal() {
    document.getElementById('reportModal').classList.add('hidden');
}
</script>
{% endblock %}

